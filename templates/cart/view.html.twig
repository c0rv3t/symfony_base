{% extends 'base.html.twig' %}

{% block title %}{{ "title.cart" | trans }}{% endblock %}

{% block body %}
<div class="container text-center my-5">
    <h1>{{ "cart.yourOrder" | trans }}:</h1>

    {% for type, messages in app.flashes %}
        {% for message in messages %}
            <div class="alert alert-{{ type }}">
                {{ message }}
            </div>
        {% endfor %}
    {% endfor %}

    {% if order.orderItem is not empty %}
        <div class="row justify-content-md-center">
            <div class="col-12">
                <table class="table table-striped table-responsive-lg my-3">
                    <thead class="thead-dark">
                        <tr>
                            <th>{{ "cart.product" | trans }}</th>
                            <th>{{ "cart.price" | trans }}</th>
                            <th>{{ "cart.quantity" | trans }}</th>
                            <th>{{ "cart.total" | trans }}</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in order.orderItem %}
                            <tr>
                                <td>{{ item.product.name }}</td>
                                <td>{{ item.productPrice }} €</td>
                                <td>{{ item.quantity }}</td>
                                <td>{{ item.productPrice * item.quantity }} €</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <h3>{{ "cart.totalPrice" | trans }}: {{ total }} €</h3>
            </div>
        </div>
    {% else %}
        <h1>{{ "cart.emptyCart" | trans }}</h1>
    {% endif %}

    {% if order.status.toString() == 'Pending' %}
        <form action="{{ path('cart_pay') }}" method="POST" class="mt-3">
            <input type="hidden" name="_token" value="{{ csrf_token('cart_pay') }}">
            <button type="submit" class="btn btn-success">Pay</button>
        </form>
        <form action="{{ path('order_cancel', { id: order.id }) }}" method="post" style="display:inline;">
            <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to cancel this order?');">Cancel Order</button>
        </form>
    {% else %}
        <button class="btn btn-secondary btn-sm" disabled>Not Cancelable</button>
    {% endif %}
</div>
{% endblock %}